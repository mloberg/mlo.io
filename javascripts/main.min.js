/*
mattwritescode.com js
license: MIT License
*/
String.prototype.replaceAt=function(a,b,c){return this.substr(0,a)+c+this.substr(b)};var Site=new Class({initialize:function(){this.hideAddressBar();this.mobileNav()},hideAddressBar:function(){setTimeout(function(){window.scrollTo(0,1)},0)},mobileNav:function(){var a=$$("#nav ul > li"),b=$$("#nav select");a.each(function(a,c){a=a.getFirst("a");b.adopt(new Element("option",{value:a.get("href"),html:a.get("text")}))});$$("#nav select").addEvent("change",function(){var a=this.getElement(":selected");window.location=a.get("value")})},home:function(){this.loadTweets();this.loadGists(5)},projects:function(){this.loadGists(10)},music:function(){var a=(new Request.JSONP({url:"http://ws.audioscrobbler.com/2.0/",callbackKey:"callback",data:{format:"json",method:"user.getRecentTracks",user:"mloberg",limit:10,api_key:"75e65c2142c7c0faa7e4c1094bd06e80"},onRequest:function(){$("music").set("html",'<h4 class="center">Loading recently played from Last.fm</h4>')},onFailure:function(){$("music").set("html",'<h4 class="center">Could not load tracks from Last.fm</h4>')},onComplete:function(a){var b=0,c="";Object.each(a.recenttracks.track,function(a){var d=a.artist["#text"],e=a.album["#text"],f=a.url,g=a.name,h;Object.each(a.image,function(a){if(a["#text"].match(/\d{3}.?\/\d+\.(png|jpg)/)&&!h){h=a["#text"]}});if(b===0){c+='<div class="row recent">';c+='<div class="span2 offset4">';c+='<img src="'+h+'" alt="'+e+'" />';c+="</div>";c+='<div class="span3">';c+='<h3><a href="'+f+'">'+g+"</a></h3>";c+="<p>"+d+"</p>";c+="</div>";c+="</div>";c+='<div class="hr"></div>'}else{c+='<div class="row">';c+='<div class="span12">';c+='<h4 class="center">';c+='<a href="'+f+'">'+g+"</a>";c+="<small> "+d+"</small>";c+="</h4>";c+="</div>";c+="</div>"}b++});$("music").set("html",c)}})).send()},loadTweets:function(){var a=(new Request.JSONP({url:"https://api.twitter.com/1/statuses/user_timeline.json",callbackKey:"callback",data:{include_entities:true,include_rts:true,exclude_replies:true,screen_name:"mloberg",count:5},onRequest:function(){$("tweets").set("html","<ul><li>Loading Tweets...</li></ul>")},onFailure:function(){$("tweets").set("html","<ul><li>Could not connect to Twitter.</li></ul>")},onComplete:function(a){var b="<ul>";Object.each(a,function(a){var c=a.text,d=[],e=0;Object.each(a.entities.hashtags,function(a){d[a.indices[0]]={start:a.indices[0],end:a.indices[1],replace:'<a href="http://twitter.com/search/%23'+a.text+'">#'+a.text+"</a>"}});Object.each(a.entities.user_mentions,function(a){d[a.indices[0]]={start:a.indices[0],end:a.indices[1],replace:'<a href="http://twitter.com/'+a.screen_name+'">@'+a.screen_name+"</a>"}});Object.each(a.entities.urls,function(a){d[a.indices[0]]={start:a.indices[0],end:a.indices[1],replace:'<a href="'+a.expanded_url+'">'+a.display_url+"</a>"}});Array.each(d,function(a,b){c=c.replaceAt(a.start+e,a.end+e,a.replace);e+=a.replace.length-(a.end-a.start)});b+="<li>"+c+"</li>"});b+="</ul>";$("tweets").set("html",b)}})).send()},loadGists:function(a){var b=(new Request.JSONP({url:"https://api.github.com/users/mloberg/gists",callbackKey:"callback",onRequest:function(){$("gists").set("html","<ul><li>Loading Gists...</li></ul>")},onFailure:function(){$("gists").set("html","<ul><li>Could not load Gists.</li></ul>")},onComplete:function(b){var c="<ul>",d=0;Object.each(b.data,function(b){if(d<a){c+='<li><a href="'+b.html_url+'">'+b.description+"</a></li>"}d++});c+="</ul>";$("gists").set("html",c)}})).send()}})